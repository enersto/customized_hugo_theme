---
title: 信用评分卡模型与刻度建立
author: ''
date: '2019-03-01'
slug: 信用评分卡模型与刻度
categories: []
tags: []

---


```{r include=FALSE}
library(data.table)
library(scorecard)
library(caret)
library(DescTools)
```

以R为工具展开的信用评分卡模型讨论并不少见，一方面，逻辑回归模型作为基础工具，已经有不少包将使用过程打磨的逞心如意；另一方面，R中丰富的机器学习分类算法，也为评分卡模型提供了更为多样的选择。

同时，现有的讨论也存在一个明显问题，多数讨论仅停留在如何根据算法构造出模型，并基于一般模型的评价方式，评价选择出一个适用性和有效性兼具的模型。但着墨于模型与最终可用评分卡之间的文章依然鲜少可见，使用选出的模型产出评分卡刻度表似乎成为可有可无的步骤，而对于一般评分卡模型稳定性的评价也无从谈起。因此，本文将会重点讨论，由模型选出到最终评分卡建立过程，以及一个模型向最终评分卡转化过程中需要注意的点和使用工具的讨论。

本文使用[Lending Club Loan Data](https://www.kaggle.com/wendykan/lending-club-loan-data)作为案例数据，该数据集的探索性分析已有很多不错的kernel完成了，本文仅作简单介绍，就不再敷言全程。具体内容可参看以下kernel：

* [Lending Club Loan Analysis](https://www.kaggle.com/janiobachmann/lending-club-risk-analysis-and-metrics)
* [Credit Risk Modelling [EDA & Classification]](https://www.kaggle.com/ionaskel/credit-risk-modelling-eda-classification)

同时，本文在评分卡构建部分使用[scorecard包](https://cran.r-project.org/package=scorecard)完成。

## 数据准备
数据集可由[Lending Club Loan Data](https://www.kaggle.com/wendykan/lending-club-loan-data)获得。
```{r include=FALSE}
options(scipen = 8)
loan = fread("C:/Users/pauke/Downloads/loan.csv")
```

该数据集结果变量y为loan_status，其基本情况为：
```{r}

Desc(loan$loan_status)

```

可以看出，该变量不是一般意义的good、bad的y变量。为了更好、更准确的建立模型，根据该数据集的说明，可归类为：

```{r}

loan <- loan[,y := 
                       ifelse(loan_status %in% c("Charged Off", "Default", 
                                                 "Does not meet the credit policy. Status:Charged Off", 
                                                 "In Grace Period","Late (16-30 days)", 
                                                 "Late (31-120 days)"),"bad","good")]
loan <- loan[,y := factor(y,levels = c("good","bad"))]
Desc(loan$y)

```


## 变量筛选

基于[Credit Risk Modelling [EDA & Classification]](https://www.kaggle.com/ionaskel/credit-risk-modelling-eda-classification)和[Lending Club Loan Analysis](https://www.kaggle.com/janiobachmann/lending-club-risk-analysis-and-metrics)这两篇文章的结论，结合日常业务经验。考虑选择以下变量构成最后的模型：

* loan_amnt , 
* int_rate , 
* grade , 
* emp_length , 
* home_ownership , 
* annual_inc , 
* term,
* dti,
* purpose

关于这些变量的具体分布情况，此处就不赘述，可参考以上提到的两篇文章。

此外，scorecard包提供了一个变量粗筛var_filter函数可供参考，其设定为删除信息值<0.02、缺失率>95%、单类别比例>95%的变量。

```{r}
loan_selected <- loan[,c("loan_amnt","int_rate","dti",
                         "purpose","term","annual_inc","home_ownership","emp_length","grade","y")]
loan_m <- var_filter(loan_selected,y = "y")
names(loan_selected)

```

通过对之前选出来的变量进行检验，可以发现只有「emp_length」变量没有通过筛选。进一步看这个变量的具体情况：

```{r}

Desc(emp_length ~ y,loan_selected)

ivs <- iv(loan_selected, y = "y")
```


「emp_length」在缺失率>95%、单类别比例>95%这两条上都没有满足，






